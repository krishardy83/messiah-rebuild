---
import Icon from "../../components/icon.astro";
import Youtube from "../../components/youtube.astro";
import InternationalInfo from "./international-info.astro";
import LearnMore from "./learn-more.astro";
import StepApply from "./step-apply.astro";
import StepCommit from "./step-commit.astro";
import StepEnroll from "./step-enroll.astro";
import StepExplore from "./step-explore.astro";
---

<div
  x-data="{
      selectedId: null,
      init() {
          // Set the first available tab on the page on page load.
          this.$nextTick(() => this.select(this.$id('tab', 1)))
      },

      select(id) {
          this.selectedId = id
      },

      isSelected(id) {
          return this.selectedId === id
      },
      
      whichChild(el, parent) {
          return Array.from(parent.children).indexOf(el) + 1
      }
  }"
  x-id="['tab']"
  class="bg-gray-100 border border-gray-300 p-4"
>
  <ul
    x-ref="tablist"
    @keydown.right.prevent.stop="$focus.wrap().next()"
    @keydown.home.prevent.stop="$focus.first()"
    @keydown.page-up.prevent.stop="$focus.first()"
    @keydown.left.prevent.stop="$focus.wrap().prev()"
    @keydown.end.prevent.stop="$focus.last()"
    @keydown.page-down.prevent.stop="$focus.last()"
    role="tablist"
    class="flex justify-evenly gap-4"
  >
    <li>
      <button
        :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
        @click="select($el.id)"
        @mousedown.prevent
        @focus="select($el.id)"
        type="button"
        :tabindex="isSelected($el.id) ? 0 : -1"
        :aria-selected="isSelected($el.id)"
        :class="isSelected($el.id) ? 'text-primary-800' : 'text-gray-400'"
        class="flex flex-col items-center font-title font-bold hover:text-primary-800 px-4"
        role="tab"
      >
        <Icon name="search" class="size-10 mb-2" />
        <span class="text-2xl">Explore</span>
        <span class="uppercase text-lg">Step 1</span>
      </button>
    </li>

    <li>
      <button
        :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
        @click="select($el.id)"
        @mousedown.prevent
        @focus="select($el.id)"
        type="button"
        :tabindex="isSelected($el.id) ? 0 : -1"
        :aria-selected="isSelected($el.id)"
        :class="isSelected($el.id) ? 'text-primary-800' : 'text-gray-400'"
        class="flex flex-col items-center font-title font-bold hover:text-primary-800 px-4"
        role="tab"
      >
        <Icon name="airplane" class="size-10 mb-2" />
        <span class="text-2xl">Apply</span>
        <span class="uppercase text-lg">Step 2</span>
      </button>
    </li>

    <li>
      <button
        :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
        @click="select($el.id)"
        @mousedown.prevent
        @focus="select($el.id)"
        type="button"
        :tabindex="isSelected($el.id) ? 0 : -1"
        :aria-selected="isSelected($el.id)"
        :class="isSelected($el.id) ? 'text-primary-800' : 'text-gray-400'"
        class="flex flex-col items-center font-title font-bold hover:text-primary-800 px-4"
        role="tab"
      >
        <Icon name="users" class="size-10 mb-2" />
        <span class="text-2xl">Commit</span>
        <span class="uppercase text-lg">Step 3</span>
      </button>
    </li>

    <li>
      <button
        :id="$id('tab', whichChild($el.parentElement, $refs.tablist))"
        @click="select($el.id)"
        @mousedown.prevent
        @focus="select($el.id)"
        type="button"
        :tabindex="isSelected($el.id) ? 0 : -1"
        :aria-selected="isSelected($el.id)"
        :class="isSelected($el.id) ? 'text-primary-800' : 'text-gray-400'"
        class="flex flex-col items-center font-title font-bold hover:text-primary-800 px-4"
        role="tab"
      >
        <Icon name="book" class="size-10 mb-2" />
        <span class="text-2xl">Enroll</span>
        <span class="uppercase text-lg">Step 4</span>
      </button>
    </li>
  </ul>

  <div role="tabpanel" class="mt-4">
    <section
      x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
      :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
      role="tabpanel"
      class="bg-white p-4 flex flex-col md:flex-row gap-4 border border-gray-300"
    >
      <div class="md:w-2/3">
        <StepExplore />
      </div>

      <aside class="md:w-1/3 flex flex-col gap-4">
        <LearnMore />
        <InternationalInfo />
      </aside>
    </section>

    <section
      x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
      :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
      role="tabpanel"
      class="bg-white p-4 flex flex-col md:flex-row gap-4 border border-gray-300"
    >
      <div class="md:w-2/3">
        <StepApply />
      </div>

      <aside class="md:w-1/3">
        <InternationalInfo />
      </aside>
    </section>

    <section
      x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
      :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
      role="tabpanel"
      class="bg-white p-4 flex flex-col md:flex-row gap-4 border border-gray-300"
    >
      <div class="md:w-2/3">
        <StepCommit />
      </div>

      <aside class="md:w-1/3 flex flex-col gap-4">
        <Youtube videoId="5_svwEuH9fY" litebox />
        <InternationalInfo />
      </aside>
    </section>

    <section
      x-show="isSelected($id('tab', whichChild($el, $el.parentElement)))"
      :aria-labelledby="$id('tab', whichChild($el, $el.parentElement))"
      role="tabpanel"
      class="bg-white p-4 flex flex-col md:flex-row gap-4 border border-gray-300"
    >
      <div class="md:w-2/3">
        <StepEnroll />
      </div>

      <aside class="md:w-1/3 flex flex-col gap-4">
        <Youtube videoId="-7mjERhLpeY" litebox />
        <InternationalInfo />
      </aside>
    </section>
  </div>
</div>
